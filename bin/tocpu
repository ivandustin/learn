#!/usr/bin/env python
from orbax.checkpoint import StandardCheckpointer
from flax.nnx import split, merge
from jax import device_put
from learn.paths.state import MODEL
from learn.state.save import save
from learn.load import load

with StandardCheckpointer() as checkpointer:
    model = load(checkpointer)
    graph, state = split(model)
    state = device_put(state)
    model = merge(graph, state)
    outpath = MODEL.with_suffix(".cpu")
    save(checkpointer, outpath, model)
